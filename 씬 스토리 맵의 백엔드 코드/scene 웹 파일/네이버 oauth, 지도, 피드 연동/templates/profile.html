<!DOCTYPE html>
<html lang="ko"> <!-- 문서 언어를 한국어로 설정 -->

<head>
    <meta charset="UTF-8"> <!-- 문자 인코딩을 UTF-8로 설정 -->
    <title>프로필</title> <!-- 브라우저 탭에 표시될 제목 -->

    <style>
        /* 전체 프로필 영역을 수직 정렬 및 중앙 정렬 */
        .profile-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
        }

        /* 프로필 사진 스타일: 원형, 회색 배경, 커버 이미지 처리 등 */
        .profile-pic {
            width: 170px;
            height: 170px;
            border-radius: 50%; /* 원형으로 만들기 */
            background-color: #ccc; /* 기본 배경색 (이미지 없을 경우 표시) */
            background-size: cover;
            background-position: center;
            cursor: pointer;
            transition: box-shadow 0.3s; /* hover 시 그림자 효과 부드럽게 적용 */
        }

        /* 마우스를 올렸을 때 그림자 효과 */
        .profile-pic:hover {
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        /* 파일 입력 필드를 숨김 (이미지 클릭으로 파일 업로드 트리거) */
        #fileInput {
            display: none;
        }

        /* 자기소개 입력창 스타일 */
        textarea {
            width: 300px;
            resize: none; /* 크기 조절 비활성화 */
            font-size: 16px;
        }

        /* 버튼에 상단 마진 추가 */
        button {
            margin-top: 10px;
        }

        /* 제목 가운데 정렬 */
        h3 {
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="profile-container"> <!-- 전체 프로필 UI 컨테이너 -->
        <h3>{{ user.nickname }} 님의 프로필</h3> <!-- 사용자 닉네임 출력 -->

        <!-- 프로필 사진 업로드 폼 -->
        <form action="{{ url_for('upload_profile_pic') }}" method="POST" enctype="multipart/form-data">
            <!-- 라벨 클릭 시 파일 선택창 열기 -->
            <label for="fileInput">
                <!-- 프로필 사진 영역: 배경 이미지로 프로필 사진 표시 -->
                <div class="profile-pic" id="profilePic"
                     style="background-image:url('/static/uploads/{{ user.profile_picture if user.profile_picture else '83d9999d-912c-46af-8316-3a80aa31da55.jpg' }}');">
                </div>
            </label>

            <!-- 실제 파일 선택 input (숨김 처리됨) -->
            <input type="file" id="fileInput" name="profile_pic" accept="image/png, image/jpeg" onchange="loadPreview(event)">
            <!-- 업로드 버튼 -->
            <button type="submit">프로필 사진 저장</button>
        </form>

        <!-- 자기소개 수정 폼 -->
        <form action="{{ url_for('update_intro') }}" method="POST">
            <!-- 자기소개 텍스트 입력 -->
            <textarea name="intro_text" rows="5" placeholder="자기소개를 작성하세요">{{ user.introduction }}</textarea><br>
            <!-- 저장 버튼 -->
            <button type="submit">프로필 소개문구 저장</button>
        </form>

        <!-- 계정 삭제 폼 -->
        <form action="{{ url_for('delete_account') }}" method="POST" onsubmit="return confirm('정말로 계정을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.');">
            <button type="submit" style="background-color:red; color:white;">해당 계정 삭제</button>
        </form>
    </div>

    <!-- 자바스크립트: 파일 선택 시 미리보기 적용 -->
    <script>
        function loadPreview(event) {
            const input = event.target;

            if (input.files && input.files[0]) {
                const reader = new FileReader(); // 파일 읽기 객체 생성

                reader.onload = function (e) {
                    // 파일 로드 완료되면 프로필 사진 영역에 미리보기 표시
                    document.getElementById('profilePic').style.backgroundImage = `url('${e.target.result}')`;
                };
                reader.readAsDataURL(input.files[0]); // 파일을 데이터 URL로 읽기
            }
        }
    </script>
</body>

</html>